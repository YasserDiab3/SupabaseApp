<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>توليد مفتاح API السري</title>
    <style>
        * { box-sizing: border-box; }
        body { font-family: system-ui, 'Segoe UI', sans-serif; max-width: 560px; margin: 2rem auto; padding: 1rem; background: #f5f5f5; }
        h1 { font-size: 1.25rem; color: #1a1a1a; margin-bottom: 0.5rem; }
        p { color: #555; font-size: 0.9rem; margin: 0.5rem 0; }
        .box { background: #fff; border: 1px solid #ddd; border-radius: 8px; padding: 1rem; margin: 1rem 0; }
        .key { font-family: ui-monospace, monospace; font-size: 0.85rem; word-break: break-all; background: #f8f8f8; padding: 0.75rem; border-radius: 6px; margin: 0.5rem 0; }
        button { background: #0d6efd; color: #fff; border: none; padding: 0.5rem 1rem; border-radius: 6px; cursor: pointer; font-size: 0.9rem; margin-left: 0.5rem; }
        button:hover { background: #0b5ed7; }
        button.secondary { background: #6c757d; }
        button.secondary:hover { background: #5c636a; }
        .done { color: #198754; font-size: 0.85rem; margin-top: 0.5rem; }
        label { display: block; font-weight: 600; font-size: 0.85rem; margin-top: 0.75rem; color: #333; }
        small { display: block; color: #666; font-size: 0.8rem; margin-top: 0.25rem; }
    </style>
</head>
<body>
    <h1>توليد مفتاح API السري (HSE_API_SECRET)</h1>
    <p>استخدم هذا المفتاح في Supabase (Edge Functions → Secrets) وفي الملف <code>js/config.js</code>.</p>

    <div class="box">
        <button type="button" id="generate">توليد مفتاح جديد</button>
        <div id="keyBox" style="display: none;">
            <label>المفتاح (انسخه واحفظه في مكان آمن):</label>
            <div class="key" id="keyDisplay"></div>
            <button type="button" id="copyKey">نسخ المفتاح</button>
            <span class="done" id="copyDone" style="display: none;">تم النسخ</span>
        </div>
    </div>

    <div class="box" id="configBox" style="display: none;">
        <label>السطر المطلوب في <code>Frontend/js/config.js</code>:</label>
        <small>استبدل السطر الذي يبدأ بـ <code>global.__CONFIG__.HSE_API_SECRET</code> بهذا السطر.</small>
        <div class="key" id="configLine"></div>
        <button type="button" id="copyConfig">نسخ السطر</button>
        <span class="done" id="configDone" style="display: none;">تم النسخ</span>
    </div>

    <div class="box">
        <label>في Supabase (Edge Functions → Secrets):</label>
        <small>Name: <strong>HSE_API_SECRET</strong></small>
        <small>Value: (الصق نفس المفتاح الظاهر في البطاقة الأولى أعلاه)</small>
    </div>

    <script>
        function generateSecret() {
            var arr = new Uint8Array(32);
            if (typeof crypto !== 'undefined' && crypto.getRandomValues) {
                crypto.getRandomValues(arr);
            } else {
                for (var i = 0; i < 32; i++) arr[i] = Math.floor(Math.random() * 256);
            }
            var hex = Array.from(arr).map(function(b) { return b.toString(16).padStart(2, '0'); }).join('');
            return hex;
        }

        var currentKey = '';

        document.getElementById('generate').onclick = function() {
            currentKey = generateSecret();
            document.getElementById('keyDisplay').textContent = currentKey;
            document.getElementById('keyBox').style.display = 'block';
            document.getElementById('configLine').textContent = "global.__CONFIG__.HSE_API_SECRET = '" + currentKey + "';";
            document.getElementById('configBox').style.display = 'block';
            document.getElementById('copyDone').style.display = 'none';
            document.getElementById('configDone').style.display = 'none';
        };

        document.getElementById('copyKey').onclick = function() {
            navigator.clipboard.writeText(currentKey).then(function() {
                document.getElementById('copyDone').style.display = 'inline';
                setTimeout(function() { document.getElementById('copyDone').style.display = 'none'; }, 2000);
            });
        };

        document.getElementById('copyConfig').onclick = function() {
            var line = "global.__CONFIG__.HSE_API_SECRET = '" + currentKey + "';";
            navigator.clipboard.writeText(line).then(function() {
                document.getElementById('configDone').style.display = 'inline';
                setTimeout(function() { document.getElementById('configDone').style.display = 'none'; }, 2000);
            });
        };
    </script>
</body>
</html>
